<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sirate</title>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="../css/style.css">

</head>
<body>
<div class="app">
    <nav class="nav-extended">
        <div class="nav-wrapper">
            <a href="/" class="logo">
                <img src="../css/sirate.png" alt="sirate">
            </a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
            </ul>
        </div>
        <div class="nav-content">
            <ul class="tabs tabs-transparent">
                <li class="tab"><a href="/">Home</a></li>
            </ul>
        </div>
    </nav>
     <body>
           <center>
           <h3 id="header"> Edit Review </h3>
        </center>
      <div class="container">

 <div class="row">
    <form id="create_form" class="col s12" method="POST" action="/">
      <div class="row">
      
        <div class="input-field col s6">
        <input placeholder="Officer Name" id="off_name" type="text" class="validate">
          <label for="off_name">Officer Name</label>
         
        </div>
        <div class="input-field col s6">
        <input placeholder="Officer Name" id="off_num" type="text" class="validate">
          <label for="off_num">Officer Badge Number</label>
      </div>
      <div class="row">
        <div class="input-field col s12">
        <textarea placeholder="Review" id="review" class="materialize-textarea"></textarea>
          <label for="review">Review</label>
        </div>
      </div>
   <div class="row">
  <div class="input-field col s12">
    <select name="rating" id="rating">
      <option value="5">5</option>
      <option value="4">4</option>
      <option value="3">3</option>
      <option value="2">2</option>
      <option value="1">1</option>
    </select>
    <label for="rating">Rating</label>
  </div>
</div>
      <div class="row">
        <div class="input-field col s12">
          <input placeholder="Location" id="location" type="text" class="validate">
          <label for="location">Location</label>
        </div>

<div class="row">

          <a id="like_btn" class="btn-floating btn-large waves-effect waves-light black" ><i class="material-icons">thumb_up</i></a>
          <a id="dislike_btn" class="btn-floating btn-large waves-effect waves-light black" ><i class="material-icons">thumb_down</i></a>
        <center>
        <button type="submit" id="submit" class="btn btn-primary">Save</button>
        </center>
    </form>
  </div>
    </div>

</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<!-- Compiled and minified CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">

<!-- Compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>

<script>

$(document).ready(function() {
     $('#rating').formSelect();
     let current_uid = 0;
    $.ajax({
        url : "/api/me/user",
        type: "GET",
        success: function(result) {
            let nav = $("#nav-mobile");
            nav.append('<li>' + `<a href="/me/">${result[0].name}</a>` + '</li>');
            current_uid = result[0].uid;
            console.log(result);
        },
        error: function(e) {
            let nav = $("#nav-mobile");
            nav.append(' <li><a href="/login">Login</a></li>'+
                '<li><a href="/register">Sign Up</a></li>')
        }
    });

    let url = window.location.href
    let sub = url.replace('http://localhost:4000/review/', '')
    let rid = parseInt(sub);
    let owner_id = 0;
    let likes = 0;
    let dislikes = 0;
      $.ajax({
        url : "/api/reviews/" + rid,
        type: "GET",
        success: function(result) {
            owner_id = result[0].uid;
            $('#off_name').val(result[0].off_name);
            $("#off_num").val(result[0].off_num)
            $('#review').text(result[0].rev);
            $("#rating").val(result[0].rating);
            $("#location").val(result[0].location);
            dislikes = result[0].dislikes;
            likes = result[0].likes;
            $('#rating').formSelect();
            if (owner_id != current_uid) {
                $('#off_name').attr('disabled', true);
                $('#off_num').attr('disabled', true);
                $('#review').attr('disabled', true);
                $('#location').attr('disabled', true);
                $('#rating').attr('disabled', true);
                $('#rating').formSelect();
                $("#header").text("See Review");
            }
            console.log(result);
            console.log(current_uid, owner_id);
        },
        error: function(e) {
            console.log(e);
        }
    });
    $("#like_btn" ).click(function() {
        likes += 1;
        $('#like_btn').text(likes);
        $('#dislike_btn').attr('disabled', true);
         $(function() {
        $('#create_form').on('submit', (e) => {
         e.preventDefault();
        let formData = {
            'likes': likes,
        };
          $.ajax({
            url : "/api/reviews/liked/" + rid,
            type: "PUT",
            data: JSON.stringify(formData),
            contentType: 'application/json',
            success: function(result){
                window.location.href = "/";
                    console.log(result);
            },
            error: function(e) {
                alert(e.responseText);;
                console.log(e);
            }
        });
    });
        });
    });
    $("#dislike_btn" ).click(function() {
        dislikes += 1;
        $('#dislike_btn').text(dislikes);
        $('#like_btn').attr('disabled', true);
         $(function() {
        $('#create_form').on('submit', (e) => {
         e.preventDefault();
        let formData = {
            'dislikes': dislikes,
        };
          $.ajax({
            url : "/api/reviews/disliked/" + rid,
            type: "PUT",
            data: JSON.stringify(formData),
            contentType: 'application/json',
            success: function(result){
                window.location.href = "/";
                    console.log(result);
            },
            error: function(e) {
                alert(e.responseText);;
                console.log(e);
            }
        });
    });
        });
        
    $(function() {
        $('#create_form').on('submit', (e) => {
         e.preventDefault();
        let officer_name = $('#officer_name').val();
        let officer_badge_num = $('#officer_badge_num').val();
        let review = $('#review').val();
        let rating = $('#rating').val();
        let location = $('#location').val();
        let formData = {
            'rev': review,
            'rating': rating,
            'off_name': officer_name,
            'off_num': officer_badge_num,
            'location': location,
            'likes': likes,
            'dislikes': dislikes,
            'uid': current_uid
        };
          $.ajax({
            url : "/api/reviews/" + rid,
            type: "PUT",
            data: JSON.stringify(formData),
            contentType: 'application/json',
            success: function(result){
                window.location.href = "/";
                    console.log(result);
            },
            error: function(e) {
                alert(e.responseText);
                console.log(e);
            }
        });
    })
        });
    });
       });

</script>
</html>
